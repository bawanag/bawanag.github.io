[{"word":[],"url":"https://bawanag.github.io/2020/12/20/Comparison-of-Different-Deep-Learning-Technologies/","title":"Comparison of Different Deep Learning technologies toward Choosing Appropriate Convolution Neural Network architecture","content":"\n\n","author":"Yuanjian Tao","categorie":{"url":"https://bawanag.github.io/categories/Dissertation/","name":"Dissertation"},"date":"2020-12-20 18:41:20"},{"word":["MathJax",".","Hub",".","Confg","(","{","tex","2","jax",":","{","nlneMath",":","[","[","'","$","'",",","'","$","'","]",",","[","\"","\\","\\","(","\"",",","\"","\\","\\",")","\"","]","]",",","processEscapes",":","true","}","}",")",";","MathJax",".","Hub",".","Confg","(","{","tex","2","jax",":","{","skpTags",":","[","'","scrpt","'",",","'","noscrpt","'",",","'","style","'",",","'","textarea","'",",","'","pre","'",",","'","coe","'","]","}","}",")",";","MathJax",".","Hub",".","Queue","(","functon","(",")","{","ar","all","=","MathJax",".","Hub",".","getAllJax","(",")",",",";","for","(","=","0",";","\"",">","前言","AI","的","学习","跟","别的","不同的","CS","学科","很不","一样","，","在","CS","的","大型","工程","中","，","往往","OOP","思想","是","目前","大型","工程","的","主流","建构","思想","，","在","成熟的","架构","例如","JaaEE","框架","下","，","不同层次","的","开发者","互相","之间","大部分","是","没","必要","互相","沟通","了解","架构","的","，","只","需要","底层","的","开发者","提供","好","需要","的","接口","以及","做好","说明","文档","，","上层","的","开发者","就","可以","“","即","用","即","走","”","。","但是","在","AI","领域","，","在","很多","应用","方面","，","不","深入","理解","框架","下","底层","的","运作","模式","和","机制","，","是","很难","应付","不同的","业务","需求","以及","对","架构","的","性能","效率","进行","深入","调优","。","而且","，","AI","大","部分","的","架构","知识","是","基于","数学","运算","，","需要","基于","数学","理论","的","理解","分析","才","可以","更好","的","利用","到","实际","的","应用","中","。","介绍","感知","器","(","Perceptron",")","诞生","于康奈尔","航空","实验室","（","Cornell","Aeronautcal","Laboratory","）","，","是","一种","尝试","模拟","人类","以及","动物","的","神经网络","的","算法","，","基于","给定","有","一定","逻辑","数理","的","数据","可以","进行","判断","不同类型","的","判断","，","为了","提升","判断","的","准确度","，","给予","感知","器","不同","输入","（","nput","）","以及","正确的","输出","目标","（","target","）","可以","实现","感知","器","的","训练","，","从而","可以","完成","数据","的","分类","，","感知","器","在","卷积","神经网络","（","Conolutonal","Neural","Network","）","以及","各种二","分类","多","分类","问题","有","广泛的","应用","。","Object","设计","单层","感知","器","以及","将","多","个","感知","器","并行","来","作为","多层","感知","器","（","如","下图","所","示","）","，","根据","输入","的","花瓣","以及","花萼","的","长","宽","对","鸢尾","花","进行","分类","。","思路","首先","我们","需要","理解","感知","器","的","原理","，","我们","可以","从","单层","感知","器","构造","开始","。","$","x","_","2","=","x","_","1","+","1","$","x","=","(","-","b","+","-","sqrt","(","b","^","2","-","4","ac",")",")","(","2","a",")","."],"url":"https://bawanag.github.io/2020/06/25/%E4%BD%BF%E7%94%A8%E7%AE%80%E5%8D%95%E7%9A%84%E5%A4%9A%E5%B1%82%E6%84%9F%E7%9F%A5%E5%99%A8%EF%BC%88Muti-Perceptron%EF%BC%89%E9%80%9A%E8%BF%87%E8%8A%B1%E7%93%A3%E4%BB%A5%E5%8F%8A%E8%8A%B1%E8%90%BC%E7%9A%84%E9%95%BF%E5%AE%BD%E5%8C%BA%E5%88%86%E5%8F%98%E8%89%B2%E9%B8%A2%E5%B0%BE%EF%BC%8C%E5%B1%B1%E9%B8%A2%E5%B0%BE%EF%BC%8C%E4%BB%A5%E5%8F%8A%E7%BB%B4%E5%90%89%E5%B0%BC%E4%BA%9A%E9%B8%A2%E5%B0%BE/","title":"使用简单的多层感知器（Muti-Perceptron）通过花瓣以及花萼的长宽区分变色鸢尾，山鸢尾，以及维吉尼亚鸢尾","content":"\n\n\n\n      MathJax.Hub.Config({\n          tex2jax: {\n            inlineMath: [ ['$','$'], [\"\\\\(\",\"\\\\)\"] ],\n           ...","author":"Yuanjian Tao","categorie":{"url":"https://bawanag.github.io/categories/Research/","name":"Research"},"date":"2020-06-25 10:45:00"},{"word":["项目","和","emo","地址","：","https",":","gthub",".","combawanagPytorch","_","Image","_","capton","_","generater",".","gt","前言","作为","机械","学习","的","重要","领域","，","CNNs","作为","图像","识别","的","重要","工具","，","目前","的","技术","已经","较为","成熟","，","根据","2021年1月29日","的","ImageNet","1000","排名","分类","数据","显示","1","，","排名","最高的","模型","Meta","Pseuo","Labels","2","得","到了","高达","90.2%","的","Top","1","精准","度","以","及","98.8%","的","Top","5","精准","度","，","当然","，","其","需要","训练","的","参数","量","也","高达","480","M",".","。","大","参数","量","的","模型","在","效率","上","基于","目前","的","硬件","算力","肯定","难以","满足","效率","上","的","需要","。","即便","如此","，","可以","在","大部分","手机","流畅","运行","的","MobleNetV","2","模型","也","拥有","高达","90%","的","Top","5","效率","3","。","因此","，","对","识别","成功","物体","类型","方面","CNN","有","极高","的","性能","以及","极","低的","运算","代价","。","因此","，","CNN","的","技术进步","为","后续","人工智能","的","应用","发展","奠定","了","坚实的","基础","。","RNN","的","出现","对","语言","生成","，","识别","以及","翻译","等","领域","有着","非常","多","的","应用","，","通过","网络","的","互相","连接","以及","之前","网络","结果","对","之后","网络","结果","的","相互","影响","，","RNN","有","一定","的","记忆","能力","，","这","赋予","了","RNN","可以","生成","通顺的","文本","以及","造句","。","但","因为","网络","联结","复杂","导致","的","梯度","爆炸","导致","反向","传播","（","Back","Propagaton","）","代价","高昂","。","但","此","并不","影响","RNN","成为","强大的","语言","架构","。","RNN","架构","发展","至今","有","许多","不同的","变化","，","Elman","Network","代表","的","单向","RNN","4","结构","以及","目前","比较","常用的","LSTM","（","Long","Short","-","Term","Memory","）","5","结构","。","得益于","Pytorch","的","优秀的","代码","结构","用户","可以","很好","的","替换","不同的","RNN","架构","。","Object","生成","CNNs","编码器","（","encoer","）","以及","RNN","解码器","（","ecoer","）","模型","，","将","其","配合","使用","共同","生成","指定","图片","标题","，","效果","如","下图","所","示","：","数据","准备",")",".","下载","DatasetDataset","选择","使用","Flckr","8","k","作为","训练","集","。","下载","训练","集","以及","标题","到","ataset","目录","下","后","，","定义","目录","位置","：","Dataset","准备","好","之后","，","我们","可以","开始","整理","数据","。",")",".","字典","生成","以及","保存","第一步","我们","先导","入","必要的","库","：","from","torchson","mport","transforms","mport","torch","mport","torch",".","nn","as","nn","mport","torchson",".","moels","as","moels","from","torch",".","nn",".","utls",".","rnn","mport","pack","_","pae","_","sequence","mport","numpy","as","np","from","torch",".","utls",".","ata","mport","Dataset","from","google",".","colab","mport","re","from","nltk",".","translate",".","bleu","_","score","mport","sentence","_","bleu","mport","matplotlb",".","pyplot","as","plt","mport","ranom","mport","atetme","生成","字典","我们","需要","先","进行","单词","统计","，","第一步","将","Flckr","8","k",".","token",".","txt","的","文件","按行","读取","出来","，","将","标题","以及","图片","文件名","分割","得到","所有","图片","标题","集合","：","ef","rea","_","lnes","(","flepath",")",":","\"","\"","\"","Open","the","groun","truth","captons","nto","memory",",","lne","by","lne",".","\"","\"","\"","fle","=","open","(","flepath",",","'","r","'",")","lnes","=","[","]","whle","True",":","#","Get","next","lne","from","fle","untl","there","'","s","no","more","lne","=","fle",".","realne","(",")","f","not","lne",":","break","lnes",".","appen","(","lne",".","strp","(",")",")","fle",".","close","(",")","return","lnes","lnes","=","rea","_","lnes","(","capton","_","r","+","token","_","fle",")","之后","需要","对","单词","进行","编号","，","统计","频率","，","生成","字典","，","所以","这里","需要","创建","一个","Vocabulary","类","进行","单词","的","录入","，","删除","，","单词","编号","互转","等","功能","：","class","Vocabulary","(","object",")",":","\"","\"","\"","Smple","ocabulary","wrapper","whch","maps","eery","unque","wor","to","an","nteger","ID",".","\"","\"","\"","ef","_","_","nt","_","_","(","self",")",":","#","Intally",",","set","both","the","IDs","an","wors","to","empty","ctonares",".","self",".","wor","2","x","=","&","#","123",";","&","#","125",";","self",".","x","2","wor","=","&","#","123",";","&","#","125",";","self",".","x","=","0","ef","a","_","wor","(","self",",","wor",")",":","#","If","the","wor","oes","not","alreay","exst","n","the","ctonary",",","a","t","f","not","wor","n","self",".","wor","2","x",":","#","如果","没有","该","单词","则","不","录入","self",".","wor","2","x","[","wor","]","=","self",".","x","self",".","x","2","wor","[","self",".","x","]","=","wor","#","Increment","the","ID","for","the","next","wor","self",".","x","+","=","1","ef","elete","_","wor","(","self",",","wor",")",":","f","wor","n","self",".","wor","2","x",":","current","_","x","=","self",".","wor","2","x","[","wor","]","self",".","wor","2","x",".","pop","(","wor",")","self",".","x","2","wor",".","pop","(","current","_","x",")","#","Increment","the","ID","for","the","next","wor","ef","translate","_","x","(","self",",","x",")",":","return","self",".","x","2","wor","[","x","]","#","transfer","the","nex","to","real","wor","ef","_","_","call","_","_","(","self",",","wor",")",":","#","If","we","try","to","access","a","wor","n","the","ctonary","whch","oes","not","exst",",","return","the","unk",">","f","not","wor","n","self",".","wor","2","x",":","return","self",".","wor","2","x","[","'","unk",">","'","]","return","self",".","wor","2","x","[","wor","]","ef","_","_","len","_","_","(","self",")",":","return","len","(","self",".","wor","2","x",")","之后","进行","单词","字典","制作","，","为了","统计","单词","出现","的","频率","我们","需要","创建","一个","数组","wor","_","counter","，","因为","不知道","单词","字典","一","共有","多少","的","单词","量","所以","我们","随便","给","这个","数组","赋","一个","较大的","容量","保证","统计","单词","频率","的","时候","不会","出现","数组","越界","：","ocabtemp","=","Vocabulary","(",")","wor","_","counter","=","np",".","zeros","(","8840",")","下一步","我们","将","每个","得到","的","句子","去掉","标点符号","，","进行","分割","单词","，","依次","录入","到","字典","里","，","因为","字典","会","自动识别","相同","的","单词","我们","不用","关心","会不会","重复","录入","，","之后","我们","将","单词","对应","的","nex","取","到","给","wor","_","counter","+","+","for","mx","_","sentence","n","lnes",":","sentence","=","mx","_","sentence",".","splt","(","'","#","'",")","[","1","]","sentence","=","sentence",".","splt","(","'","\\","t","'",")","wors","=","sentence","[","1","]",".","splt","(","'","'",")","wors",".","pop","(","len","(","wors",")","-","1",")","f","(","\"",".","\"","n","wors",")",":","wors",".","remoe","(","\"",".","\"",")","f","(","\"",",","\"","n","wors",")",":","wors",".","remoe","(","\"",",","\"",")","for","wor","n","wors",":","wor","=","wor",".","lower","(",")","ocabtemp",".","a","_","wor","(","wor",")","nx","=","ocabtemp","(","wor",")","wor","_","counter","[","nx","]","+","=","1","最后","将","开始","结束","符号","以及","必要的","分隔","符","添加","进","字典","，","排除","出现","频次","出现","少于","3次","的","单词","就","完成","字典","的","制作","：","ocab","=","Vocabulary","(",")","ocab",".","a","_","wor","(","'","pa",">","'",")","ocab",".","a","_","wor","(","'","start",">","'",")","ocab",".","a","_","wor","(","'","en",">","'",")","ocab",".","a","_","wor","(","'","unk",">","'",")","for","l","n","range","(","len","(","ocabtemp",")",")",":","f","wor","_","counter","[","l","]",">","3",":","ocab",".","a","_","wor","(","ocabtemp",".","translate","_","x","(","l",")",")","这边","建议","储存","一下","Vocabulary","对象","，","方便","之后","调用","moel","的","时候","转换","标题","生成","结果","为","可","阅读","的","语句","：","mport","pckle","f","=","open","(","ocab","_","fle",",","'","wb","'",")","pckle",".","ump","(","ocab",",","f",")","f",".","close","(",")","Dataset","和","Loaer","准备","我们","需要","再次","把","标题","以及","文件名","分割","，","这边","需要","标题","与","文件名","一一","对应","，","为了","代码","的","可读性","我们","再次","分割","一次","，","提取","标题","以及","标题","对应","的","图片","文件名","：","ef","get","_","meta","(","lnes",")",":","\"","\"","\"","Fetches","the","meta","ata","for","all","the","mages","an","assgns","labels",".","\"","\"","\"","mage","_","s",",","cleane","_","captons","=","[","]",",","[","]","for","lne","n","lnes",":","mx","_","lne","0","=","lne",".","splt","(","'","#","'",")","mx","_","lne","1","=","mx","_","lne","0","[","0","]",".","splt","(","'",".","jpg","'",")","mx","_","sentence","=","mx","_","lne","0","[","1","]",".","splt","(","'","\\","t","'",")","mage","_","s",".","appen","(","mx","_","lne","1","[","0","]",")","cleane","_","captons",".","appen","(","mx","_","sentence","[","1","]",".","lower","(",")",")","return","mage","_","s",",","cleane","_","captons","mage","_","s",",","cleane","_","captons","=","get","_","meta","(","lnes",")","为了","符合","规范","以及","提升","可读性","，","我们","将","数据","打包","成","DataFrame","方便","阅读","，","提取","数据","以及","调用","：","mport","panas","as","p","ata","=","&","#","123",";","'","mage","_","'",":","mage","_","s",",","'","path","'",":","[","mage","_","r","+","mage","_","+","\"",".","jpg","\"","for","mage","_","n","mage","_","s","]",",","'","capton","'",":","cleane","_","captons","&","#","125",";","ata","_","f","=","p",".","DataFrame","(","ata",",","columns","=","[","'","mage","_","'",",","'","path","'",",","'","capton","'","]",")","编写","Dataset","处理","类","，","将","标题","文字","转换","为","worID","，","添加","开头","以及","结束","标题","标识符","：","from","PIL","mport","Image","mport","c","2","from","nltk","mport","tokenze","class","Flckr","8","k","(","Dataset",")",":","\"","\"","\"","Flckr","8","k","custom","ataset","compatble","wth","torch",".","utls",".","ata",".","DataLoaer",".","\"","\"","\"","ef","_","_","nt","_","_","(","self",",","f",",","ocab",",","transform","=","None",")",":","\"","\"","\"","Set","the","path","for","mages",",","captons","an","ocabulary","wrapper",".","Args",":","f",":","f","contanng","mage","paths","an","captons",".","ocab",":","ocabulary","wrapper",".","transform",":","mage","transformer",".","\"","\"","\"","self",".","f","=","f","self",".","ocab","=","ocab","self",".","transform","=","transform","ef","_","_","gettem","_","_","(","self",",","nex",")",":","\"","\"","\"","Returns","one","ata","par","(","mage","an","capton",")",".","\"","\"","\"","ocab","=","self",".","ocab","capton","=","self",".","f","[","'","capton","'","]","[","nex","]",".","lower","(",")","mg","_","=","self",".","f","[","'","mage","_","'","]","[","nex","]","path","=","self",".","f","[","'","path","'","]","[","nex","]","mage","=","Image",".","open","(","open","(","path",",","'","rb","'",")",")","f","self",".","transform","s","not","None",":","mage","=","self",".","transform","(","mage",")","#","Conert","capton","(","strng",")","to","wor","s",".","tokens","=","capton",".","splt","(",")","capton","=","[","]","#","Bul","the","Tensor","erson","of","the","capton",",","wth","token","wors","capton",".","appen","(","ocab","(","'","start",">","'",")",")","for","token","n","tokens",":","nextemp","=","ocab","(","token",")","f","(","nextemp","!","=","3",")",":","capton",".","exten","(","[","nextemp","]",")","capton",".","appen","(","ocab","(","'","en",">","'",")",")","target","=","torch",".","Tensor","(","capton",")","return","mage",",","target","ef","_","_","len","_","_","(","self",")",":","return","len","(","self",".","f",")","编写","collate","_","fn","，","因为","标题","和","图片","是","多","对","一","的","关系","，","每个","图片","可能会","对应","长短不一","的","标题","，","所以","这里","我们","需要","设定","target","标题","的","pae","_","length","是","变化","的","，","Back","propagaton","时","才","可以","保证","pae","的","长度","符合","标题","的","长度","。","ef","capton","_","collate","_","fn","(","ata",")",":","#","Sort","a","ata","lst","by","capton","length","from","longest","to","shortest",".","ata",".","sort","(","key","=","lamba","x",":","len","(","x","[","1","]",")",",","reerse","=","True",")","#","laba","s","the","functon","to","suffle","the","ata","mages",",","captons","=","zp","(","*","ata",")","#","Merge","mages","(","from","tuple","of","3","D","tensor","to","4","D","tensor",")",".","mages","=","torch",".","stack","(","mages",",","0",")","#","Merge","captons","(","from","tuple","of","1","D","tensor","to","2","D","tensor",")",".","lengths","=","[","len","(","cap",")","for","cap","n","captons","]","#","因为","图片","是","一对","多","的","关系","，","我们","需要","使用","不同的","标题","训练","它","多次","targets","=","torch",".","zeros","(","len","(","captons",")",",","max","(","lengths",")",")",".","long","(",")","for",",","cap","n","enumerate","(","captons",")",":","en","=","lengths","[","]","targets","[",",",":","en","]","=","cap","[",":","en","]","return","mages",",","targets",",","lengths","定义","图片","数据","转换","，","将","图片","都","调整","为","标准","的","CNN","需求","图片","：","ata","_","transform","=","transforms",".","Compose","(","[","transforms",".","Resze","(","224",")",",","transforms",".","CenterCrop","(","224",")",",","#","Why","o","we","choose","224","x","224","?","transforms",".","ToTensor","(",")",",","transforms",".","Normalze","(","(","0.485",",","0.456",",","0.406",")",",","#","Usng","ImageNet","norms","(","0.229",",","0.224",",","0.225",")",")","]",")","最后","加载","transet","和","testset","，","定义","tran","和","testloaer","：","unt","_","sze","=","5","tran","_","splt","=","0.90","#","Defnes","the","rato","of","trantest","ata",".","test","_","splt","=","1","-","tran","_","splt","tran","_","sze","=","unt","_","sze","*","roun","(","len","(","ata","_","f",")","*","tran","_","splt","unt","_","sze",")","test","_","sze","=","unt","_","sze","*","roun","(","len","(","ata","_","f",")","*","test","_","splt","unt","_","sze",")","ataset","_","tran","=","Flckr","8","k","(","f","=","ata","_","f","[",":","]",".","reset","_","nex","(","rop","=","True",")",",","ocab","=","ocab",",","transform","=","ata","_","transform",",",")","ataset","_","test","=","Flckr","8","k","(","f","=","ata","_","f","[","tran","_","sze",":","]",".","reset","_","nex","(","rop","=","True",")",",","ocab","=","ocab",",","transform","=","ata","_","transform",",",")","tran","_","loaer","=","torch",".","utls",".","ata",".","DataLoaer","(","ataset","_","tran",",","batch","_","sze","=","64",",","shuffle","=","True",",","num","_","workers","=","0",",","collate","_","fn","=","capton","_","collate","_","fn",")","test","_","loaer","=","torch",".","utls",".","ata",".","DataLoaer","(","ataset","_","test",",","batch","_","sze","=","5",",","#","因","为","在","collect","_","fn","里面","我们","使用","lamba","函数","进行","每个","batch","的","排列","，","所以","为了","在","测试","shuffle","=","False",",","#","方便","看到","单一","图片","的","生成","标题","，","我们","使用","5","来","作为","batch","_","sze","（","5","为","flckr","8","k","5个","标题","对应","一个","图片","num","_","workers","=","0",",","collate","_","fn","=","capton","_","collate","_","fn",")","定义","CNN","encoer","和","RNN","ecoerCNN","创建","为了","加快","训练","速度","，","在","CNN","encoer","定义","时","我们","使用","Pytorch","提供","的","pre","-","trane","ResNet","152","模型","，","但是","为了","符合","我们","所","定义","的","embe","sze","(","这个","如果","定义","为","1000","训练","时","长","就","太","久了",")","我们","将","ResNet","152","的","最后","一层","fully","connecte","层","切除","：","的","num","_","classes","=","1000","改为","我们","的","embe","_","sze","的","尺寸","，","所以","我们","需要","对","ResNet","152","进行","一个","小小","的","改造","：","class","EncoerCNN","(","nn",".","Moule",")",":","ef","_","_","nt","_","_","(","self",",","embe","_","sze",")",":","\"","\"","\"","Loa","the","pretrane","ResNet","-","152","an","replace","top","fc","layer",".","\"","\"","\"","super","(","EncoerCNN",",","self",")",".","_","_","nt","_","_","(",")","resnet","=","moels",".","resnet","152","(","pretrane","=","True",")","#","Pre","-","trane","on","ImageNet","by","efault","layers","=","lst","(","resnet",".","chlren","(",")",")","[",":","-","1","]","#","切除","ResNet","152","最后","一程","、","层","#","Unpack","the","layers","an","create","a","new","Sequental","self",".","resnet","=","nn",".","Sequental","(","*","layers",")","#","We","want","a","specfc","output","sze",",","whch","s","the","sze","of","our","embeng",",","so","#","we","fee","our","extracte","features","from","the","last","fc","layer","(","mensons","1","x","1000",")","#","添加","一层","将","ResNet","152","生成","成","我们","需要","的","embe","_","sze","长度","self",".","lnear","=","nn",".","Lnear","(","resnet",".","fc",".","n","_","features",",","embe","_","sze",")","#","Batch","normalsaton","可以","加速","训练","self",".","bn","=","nn",".","BatchNorm","1","(","embe","_","sze",",","momentum","=","0.01",")","self",".","ft","=","nn",".","Flatten","(",")","ef","forwar","(","self",",","out",")",":","wth","torch",".","no","_","gra","(",")",":","out","=","self",".","resnet","(","out",")","out","=","self",".","ft","(","out",")","out","=","self",".","lnear","(","out",")","out","=","self",".","bn","(","out",")","return","out","RNN","创建","RNN","的","定义","参考","Pytorch","官方","LSTM","tutoral","，","通过","设置","RNN","的","输入","sze","，","embee","_","sze","可以","直接","构造","合适的","ecoer","层","，","但是","这边","需要","注意","把","batch","_","frst","设置","为","true","，","因为","pytorch","默认","的","RNN","读取","顺序","是","整行","读取","，","我们","需要","将","其","修改","为","多行","逐字","读取","，","Pytorch","默认","该","模式","是","为了","提高","并发","效率","，","但是","该","项目","并不","适用","这个","方向","。","class","DecoerLTSM","(","nn",".","Moule",")",":","ef","_","_","nt","_","_","(","self",",","embe","_","sze",",","hen","_","sze",",","ocab","_","sze",",","num","_","layers",",","max","_","seq","_","length","=","20",")",":","\"","\"","\"","Set","the","hyper","-","parameters","an","bul","the","layers",".","\"","\"","\"","super","(","DecoerLTSM",",","self",")",".","_","_","nt","_","_","(",")","self",".","embe","=","nn",".","Embeng","(","ocab","_","sze",",","embe","_","sze",")","#","设定","Embe","层","，","每个","单词","位置","可能","出现","的","情况","次数","以及","可能","最长的","句子","长度","设定","到","embesze","里","self",".","lnear","=","nn",".","Lnear","(","hen","_","sze",",","ocab","_","sze",")","self",".","max","_","seq","_","length","=","max","_","seq","_","length","ef","forwar","(","self",",","features",",","captons",",","lengths",")",":","\"","\"","\"","Decoe","mage","feature","ectors","an","generates","captons",".","\"","\"","\"","embengs","=","self",".","embe","(","captons",")","embengs","=","torch",".","cat","(","(","features",".","unsqueeze","(","1",")",",","embengs",")",",","1",")","packe","=","pack","_","pae","_","sequence","(","embengs",",","lengths",",","batch","_","frst","=","True",")","#","batch","_","frst","默认","为","false","可以","加速","并行","训练","效率","，","这边","为了","#","生成","的","标题","行","正确","设置","为","true","转置","RNN","输入","顺序","hens",",","_","=","self",".","lstm","(","packe",")","#","如果","想","使用","RNN","可以","将","该行","替换","为","rnn","outputs","=","self",".","lnear","(","hens","[","0","]",")","return","outputs","ef","sample","(","self",",","features",",","states","=","None",")",":","\"","\"","\"","Generate","captons","for","gen","mage","features","usng","greey","search",".","\"","\"","\"","sample","_","s","=","[","]","nputs","=","features",".","unsqueeze","(","1",")","for","n","range","(","self",".","max","_","seq","_","length",")",":","hens",",","states","=","self",".","lstm","(","nputs",",","states",")","#","hens",":","(","batch","_","sze",",","1",",","hen","_","sze",")","outputs","=","self",".","lnear","(","hens",".","squeeze","(","1",")",")","#","outputs",":","(","batch","_","sze",",","ocab","_","sze",")","_",",","precte","=","outputs",".","max","(","1",")","#","precte",":","(","batch","_","sze",")","sample","_","s",".","appen","(","precte",")","nputs","=","self",".","embe","(","precte",")","#","nputs",":","(","batch","_","sze",",","embe","_","sze",")","nputs","=","nputs",".","unsqueeze","(","1",")","#","nputs",":","(","batch","_","sze",",","1",",","embe","_","sze",")","sample","_","s","=","torch",".","stack","(","sample","_","s",",","1",")","#","sample","_","s",":","(","batch","_","sze",",","max","_","seq","_","length",")","return","sample","_","s","模型","训练","定义","训练","模型","逻辑","：","#","Tran","the","moels","ef","tran","_","moel","(","encoer",",","ecoer",",","crteron",",","optmzer",",","moel","_","type",")",":","total","_","step","=","len","(","tran","_","loaer",")","loss","_","summarze","=","[","]","for","epoch","n","range","(","nt","_","epochs",",","num","_","epochs",")",":","each","_","epoch","_","loss","=","[","]","starttme","=","entme","=","atetme",".","atetme",".","now","(",")","for",",","(","mages",",","captons",",","lengths",")","n","enumerate","(","tran","_","loaer",")",":","#","Set","mn","-","batch","ataset","mages","=","mages",".","to","(","ece",")","captons","=","captons",".","to","(","ece",")","#","Packe","as","well","as","we","'","ll","compare","to","the","ecoer","outputs","targets","=","pack","_","pae","_","sequence","(","captons",",","lengths",",","batch","_","frst","=","True",")","[","0","]","#","Forwar",",","backwar","an","optmze","#","输出","标题","生成","结果","之后","与","target","做","交叉","熵","features","=","encoer","(","mages",")","outputs","=","ecoer","(","features",",","captons",",","lengths",")","loss","=","crteron","(","outputs",",","targets",")","#","Zero","graents","for","both","networks","ecoer",".","zero","_","gra","(",")","encoer",".","zero","_","gra","(",")","loss",".","backwar","(",")","optmzer",".","step","(",")","#","#","Prnt","log","nfo","f","%","log","_","step","=","=","0",":","entme","=","atetme",".","atetme",".","now","(",")","prnt","(","'","Epoch","[","&","#","123",";","&","#","125",";","&","#","123",";","&","#","125",";","]",",","Step","[","&","#","123",";","&","#","125",";","&","#","123",";","&","#","125",";","]",",","Loss",":","&","#","123",";",":",".","4","f","&","#","125",";","，","Tme","comsumpton",":","&","#","123",";","&","#","125",";","'",".","format","(","epoch","+","1",",","num","_","epochs",",",",","total","_","step",",","loss",".","tem","(",")",",","entme","-","starttme",")",")","starttme","=","entme","each","_","epoch","_","loss",".","appen","(","loss",".","tem","(",")",")","torch",".","sae","(","ecoer",".","state","_","ct","(",")",",","moel","_","path","+","moel","_","type","+","'","-","ecoer","-","epoch","_","&","#","123",";","&","#","125",";",".","ckpt","'",".","format","(","epoch","+","1",")",")","#","因为","训练","时间","比较","长","需要","把","每个","torch",".","sae","(","encoer",".","state","_","ct","(",")",",","moel","_","path","+","moel","_","type","+","'","-","encoer","-","epoch","_","&","#","123",";","&","#","125",";",".","ckpt","'",".","format","(","epoch","+","1",")",")","#","epoch","的","模型","储存","防止","训练","终止","需要","将","训练","中用","到","的","对象","进行","创建","，","之后","进行","训练","：","#","Bul","the","LSTM","moels","encoer","=","EncoerCNN","(","embe","_","sze",")",".","to","(","ece",")","ecoer","=","DecoerLTSM","(","embe","_","sze",",","hen","_","sze",",","len","(","ocab",")",",","num","_","layers",")",".","to","(","ece",")","#","Loss","an","optmzer","crteron","=","nn",".","CrossEntropyLoss","(",")","#","因为","我们","要","利用","预","训练","模型","，","所以","这边","我们","只","需要","更新","ecoer","以及","encoe","的","fully","connecte","和","batch","normal","的","参数","params","=","lst","(","ecoer",".","parameters","(",")",")","+","lst","(","encoer",".","lnear",".","parameters","(",")",")","+","lst","(","encoer",".","bn",".","parameters","(",")",")","optmzer","=","torch",".","optm",".","Aam","(","params",",","lr","=","learnng","_","rate",")","moel","_","type","=","\"","lstm","\"","tran","_","moel","(","encoer",",","ecoer",",","crteron",",","optmzer",",","moel","_","type",")","测试","完成","训练","后","我们","可以","提取","相应","的","模型","以及","字典","进行","测试","：","preprocess","=","transforms",".","Compose","(","[","transforms",".","Resze","(","224",")",",","transforms",".","CenterCrop","(","224",")",",","#","Why","o","we","choose","224","x","224","?","transforms",".","ToTensor","(",")",",","transforms",".","Normalze","(","(","0.485",",","0.456",",","0.406",")",",","#","Usng","ImageNet","norms","(","0.229",",","0.224",",","0.225",")",")","]",")","mport","pckle","f","=","open","(","ocab","_","fle",",","'","rb","'",")","ocab","=","pckle",".","loa","(","f",")","f",".","close","(",")","encoer","_","path","=","root","+","'","lstm","-","encoer","-","epoch","_","5",".","ckpt","'","ecoer","_","path","=","root","+","'","lstm","-","ecoer","-","epoch","_","5",".","ckpt","'","encoer","=","EncoerCNN","(","embe","_","sze",")",".","to","(","ece",")","encoer",".","loa","_","state","_","ct","(","torch",".","loa","(","encoer","_","path",")",")","encoer",".","eal","(",")","ecoer","=","DecoerLTSM","(","embe","_","sze",",","hen","_","sze",",","len","(","ocab",")",",","num","_","layers",")",".","to","(","ece",")","ecoer",".","loa","_","state","_","ct","(","torch",".","loa","(","ecoer","_","path",")",")","ecoer",".","eal","(",")","自动化","的","测试","可以","使用","BLUE","进行","测试","，","但是","BLEU","有","一定","的","局限性","，","人工","打印","出来","对比","性能","可能","更","符合","目前","的","nput","_","tensor","=","preprocess","(","nput","_","mage",")","mages","=","nput","_","tensor",".","to","(","ece",")","wth","torch",".","no","_","gra","(",")",":","features","=","encoer","(","mages",".","unsqueeze","(","0",")",")","outputs","=","ecoer",".","sample","(","features",")","for","sentence","n","outputs",":","sentence","_","wor","_","queue","=","[","]","for","wor","n","sentence",":","sentence","_","wor","_","queue",".","appen","(","ocab",".","translate","_","x","(","wor",".","cpu","(",")",".","tem","(",")",")",")","new","_","sentence","=","[","]","for","generaton","_","wor","n","sentence","_","wor","_","queue",":","f","(","\"","start",">","\"","n","generaton","_","wor",")",":","contnue","elf","(","\"","en",">","\"","n","generaton","_","wor",")",":","break","new","_","sentence",".","appen","(","generaton","_","wor",")","from","nltk",".","translate",".","bleu","_","score","mport","sentence","_","bleu","#","1001773457","_","577","c","3","a","770",".","jpg","#","0","A","black","og","an","a","spotte","og","are","fghtng","#","1001773457","_","577","c","3","a","770",".","jpg","#","1","A","black","og","an","a","tr","-","colore","og","playng","wth","each","other","on","the","roa",".","#","1001773457","_","577","c","3","a","770",".","jpg","#","2","A","black","og","an","a","whte","og","wth","brown","spots","are","starng","at","each","other","n","the","street",".","#","1001773457","_","577","c","3","a","770",".","jpg","#","3","Two","ogs","of","fferent","brees","lookng","at","each","other","on","the","roa",".","#","1001773457","_","577","c","3","a","770",".","jpg","#","4","Two","ogs","on","paement","mong","towar","each","other",".","reference","=","[","[","'","a","'",",","'","black","'",",","'","og","'",",","'","an","'",",","'","a","'",",","'","spotte","'",",","'","og","'",",","'","are","'",",","'","fghtng","'","]",",","[","'","a","'",",","'","black","'",",","'","og","'",",","'","an","'",",","'","a","'",",","'","tr","-","colore","'",",","'","og","'",",","'","playng","'",",","'","wth","'",",","'","each","'",",","'","other","'",",","'","on","'",",","'","the","'",",","'","roa","'","]",",","[","'","a","'",",","'","black","'",",","'","og","'",",","'","an","'",",","'","a","'",",","'","whte","'",",","'","og","'",",","'","wth","'",",","'","brown","'",",","'","spots","'",",","'","are","'",",","'","starng","'",",","'","at","'",",","'","each","'",",","'","other","'",",","'","n","'",",","'","the","'",",","'","street","'","]",",","[","'","two","'",",","'","ogs","'",",","'","of","'",",","'","fferent","'",",","'","brees","'",",","'","lookng","'",",","'","at","'",",","'","each","'",",","'","other","'",",","'","on","'",",","'","the","'",",","'","roa","'","]",",","[","'","two","'",",","'","ogs","'",",","'","on","'",",","'","paement","'",",","'","mong","'",",","'","towar","'",",","'","each","'",",","'","other","'","]","]","score","=","sentence","_","bleu","(","reference",",","new","_","sentence",")","prnt","(","score",")","#","#","9.453946401578459","e","-","155","Reference","[","1","]","[","Image","Classfcaton","on","ImageNet","]","(","https",":","paperswthcoe",".","comsotamage","-","classfcaton","-","on","-","magenet",")","[","2","]","[","Meta","Pseuo","Labels","]","(","https",":","paperswthcoe",".","compapermeta","-","pseuo","-","labels",")","[","3","]","Comparson","of","Dfferent","Deep","Learnng","technologes","towar","Choosng","Approprate","Conoluton","Neural","Network","archtecture","[","4","]","Fnng","Structure","n","Tme","[","5","]","Long","Short","-","Term","Memory"],"url":"https://bawanag.github.io/2020/05/15/%E4%BD%BF%E7%94%A8%E5%BE%AA%E7%8E%AF%E7%A5%9E%E7%BB%8F%E7%BD%91%E7%BB%9C%EF%BC%88RecurrentNeuralNetwork%EF%BC%89%E4%BB%A5%E5%8F%8A%E5%8D%B7%E7%A7%AF%E7%A5%9E%E7%BB%8F%E7%BD%91%E7%BB%9C%EF%BC%88CNN%EF%BC%89%E7%94%9F%E6%88%90%E5%9B%BE%E7%89%87%E6%A0%87%E9%A2%98/","title":"使用循环神经网络（RecurrentNeuralNetwork）以及卷积神经网络（CNN）生成图片标题","content":"项目和demo地址：https://github.com/bawanag/Pytorch_Image_caption_generater.git\n前言作为机械学习的重要领域，CNNs作为图像识别的重要工具，目前的技术已经较为成熟，根据...","cover_picture":"“https://bawanag.github.io/images/sss.jpg\"","author":"Yuanjian Tao","categorie":{"url":"https://bawanag.github.io/categories/Tutorial/","name":"Tutorial"},"date":"2020-05-15 02:57:00"},{"word":["Hexo","以及","Hexo","amn","搭建","踩坑","部分","教程","引用","https",":","runkfsh",".","mehexo","群辉","可以","直接","使用","spurnhexo","ocker","镜","像","虽然","这个","镜","像","集成","了","Hexo","以及","Hexo","amn","，","但是","Hexo","amn","是","在线","npm","安装","，","如果","在","国内","使用","镜","像","会","出现","Hexo","amn","无法","使用","的","情况","解决","方案","是","按照","https",":","blog",".","csn",".","netyypsoberartcleetals","51906616","给出","的","方案","添加","taobao","npm","源","，","此时","不","会报","网络","错误","的","错","以及","加快","下载","安装","速度","如果","使用","Hexo","amn","添加","新的","博客","，","即使","在","—","—","confg",".","yml","上","设置","了","post","_","asset","_","foler",":","true","，","新建","文章","并","不会","同步","添加","存放","二进制文件","的","同名","文件夹","，","操作","如","下图","所","示","但","直接","在","命令行","键入","Hexo","new","文章","名称","创建","文章","是","可以","同步","创建","文章","以及","对应","的","资源","文件夹","：","但是","使用","该","方法","需要","进入","群辉","ocker","的","终端机","后台","进行","命令行","键入","，","同时","对","中文","文章","名称","支持","不好","，","这个问题","可以","使用","Hexo","amn","创建","文章","后","，","直","接手","动","在","群","辉映","射","smb","的","source","文件夹","下手","动","创建","。","GtHub","o","申请","以及","相关","踩坑","根据","以上","文章","申请","搭建","GtHub","pages","是","没问题","，","但是","创建","的","新","账号","需要","将","ocker","上面","指定","的","邮箱","设置","为","publc","，","要不然","会","提示","权限","不足","或者","邮箱","错误","。","即时","申请","的","GtHub","仓库","以及","上传","的","静态","页面","是","无法","立即","更新","页面","的","，","根据","GtHub","文档","说明","所","有的","更新","需要","20分钟","才","会","生效","，","所以","第一时间","打开",".","gthub",".","o","为","404","不用","着急","（","这点","坑害","了","好久","）","但是","关","于","以上","的","问题","，","其实","只要","保证","hexo","g","上","是","成功","上传","的","时候","是","可以","实时","更新","没问题","，","但是","有","一个","大坑","是","在","Hexo","Amn","!","根据","教程","调","Hexo","Amn","是","可以","成功","Hexo","g","之后","Hexo","，","并且","显示","gt","提交","成功","，","但是","大坑","在于","它","根本","就","没有","上传","成功","，","所以","出现","gt","上","长时间","没","更新","网页","请","更多","检查","Hexo","Amn","的","配置","以及","gt","上传","配置","，","ssh","配置","，","是否","重新","初始化","ocker","都会","影响","Hexo","amn","是否","可以","成功","上传","。","关于","重新","导入","ssh","秘钥","，","貌似","不成功","，","但是","hexo","是","基于","lnux","ssh","架构","的","机器","，","理论上","ssh","可以","正常","导入","则","gt","可以","直接","使用","ssh","秘钥","。","编辑","Markown","博客","网页","根据","我","踩坑","的","经验","，","编辑","m","文件","基本上","分为","3","大","类型","：","管理","网页","在线","编辑","直接","Vm","console","编辑","下载","m","文件","后","完成","编辑","上传","使用","编辑","工具","，","例如","scoe","+","插","件","、","typora",".",".","但是","这","一切","的","方法","都","无法","避开","的","问题","就是","插入","图片","的","问题","，","1","~","3","的","方案","都行","需要","而外","上传","图片","之后","进行","图片","的","关联","，","图片","关联","需要","图片","的","绝对路径","或者","相对","路径","。","但是","使用","这个","方案","进行","m","编辑","会","极大","影响","博客","编写","效率","。","使用","scoe","需要","分别","安装","scoe","+","markown","插","件","，","图片","粘贴","插件","以及","实时","查看","m","效果","插","件","，","会","使得","本来","装满","插件","的","scoe","变得","更加","臃肿","，","而且","这个","方案","最大","的","弊端","是","需要","本地","安装","hexo","，","对于","服务器","在","群辉","上","的","用户","来说","太过","臃肿","。","我","这边","选择","了","typora","工具","进行","编辑","，","该","工具","体积","小巧","，","点","开","即","用","，","可以","根据","https",":","clou",".","tencent",".","comeeloperartcle","1600295","进行","图片","实时","上传","和","在线","浏览","，","直接","打开","smb","关联","的","群辉","位置","即可","编辑","，","简单","好","用",",","但是","注意","在","该","教程","最后","需要","安装","hexo","-","mage","-","lnk","插件","才","可以","在","博客","上","正确","显示","图片","。","显示","图片","有","一个","很重要","的","一点","是","图片","文件名","不可以","带","空格","！","！","！",".","评论","模块","评论","模块","应该是","最","坑","的","模块","了","，","踩","了","无数","的","坑","。","首先","评论","模块","是","集成","在","主题","scheme","里面","的","，","每个","主题","模板","相互","独立","，","而且","评论","引擎","不同","评论","的","原理","，","效果","也不","同","，","部分","引擎","和","主题","因为","年","久","失修","，","会","留下","一堆","坑","让","大家","踩","，","这边","还是","推荐","如果","不想","像","我","这样","执着","于","一个","喜欢的","主题","而","疯狂","踩坑","的话","，","请","移步","更新","较为","频繁的","主题","。","年久失修","的","评论","插件","是","个","大坑","（","没错","gtment","说的","就是","你","）","我","这边","使用","的","是","Hexo","Fun","作为","博客","的","主题","，","该","主题","提供","了","gtment","以及","gttalk","来","作为","评论","引擎","，","作为","博客","小白","的","我","直接","默认","调用","了","gtment","，","发现","该","引擎","一堆","的","坑","。","首","先","该","引擎","年","久","失修","，","如果","安装","使用","旧版","的","css","以及","js","地址","是","无法","使用","的","，","必","须要","找","一个","合适的","地址","甚至","自己","搭","一个","css","或者","js","的","服务器","进行","gtment","下载","，","真","的","是","坑","无数","小弟","让","了","让","了","。","寻找","一个","适合","自己","的","评论","插件","这边","推荐","一个","比","较好","用","的","评论","插件","gttalk","（","2021年1月29日","评","，","万一","它是","下","个","年久失修","的","请","移步","）","，","该","插件","的","坑","有","以下","几点","：","创建","Applcaton","的","时候","请","创建","OAuth","APPs","！","！","！","OAuth","APPs","！","！","！","OAuth","APPs","！","！","！","而不是","GtHub","APPs","，","这坑","困扰","了","我","十分","久","，","而且","我","还","尝试","了","再","GtHub","APPs","下","勾选","了","OAuth","选项","，","实在","是","大坑","，","根本","没法","用","，","一直","*","*","报","错","Ba","creentals","*","*","，","在","偶然","的","settng","乱","点","里面","发现","了","这个","坑","！","！","！","，","而且","大家","务必","检查","好","Clent","ID","和","secret","是否","正确","，","包括","是否","需要","加","引号","（","保证","数值","传递","到","js","脚本","）","输入","正确的","Clent","I","以及","secret","之后","（","网上","各种","需要","加","引号","不","加","引号","的","，","还是","得","看","是否","吧值","传入","，","反正","我是","加","的","）","还有","一个","大坑","是","未","找到","相关","的","Issues","进行","评论",".","首先","要","在","代码","里面","包含","m","5",".","mn",".","js","生成","标题","对应","的","哈希值","，","将","标题","内容","缩短","至","50个","字符","以内","，","这边","fun","主题","是","包含","这","段","代码","的","。","但是","呀","但是","，","不是","因为","浏览器","缓存","，","如果","想","快速","看到","部署","后","的","结果","还是","得","先","清理","缓存","，","或者","使用","无","痕","窗口","嘛","，","但是","这","块","它","会","无限","的","跳出","以下","错误","：","这时候","请","移步","到","正常","浏览","界面","，","登陆","GtHub","后","使用","GtHub","的","token","对","评论","进行","初始化","。","问题","oer","总结","根据","几天","的","博客","搭建","踩坑","，","Hexo","的","博客","服务器","已经","成功","运行","起来","了","，","最后","给出","整体","方案","。","为了","方便","备份","，","方便","单独","部署","以及","数据","隔离","，","使用","ocker","+","群辉","的","方式","进行","Hexo","的","安装","ocker","上","的","项目","已","经年","久","失修","，","很多","链接","国内","已经","失效","，","需要","进入","控制台","重新","配置","白嫖","总是","有点","问题","，","gt","上","同步","时间","以及","搭建","方式","都","有","小","坑","轻","量化","的","markown","是","难以","跟","主流","的","编辑器","比较","的","，","所以","使用","趁手","的","编辑器","可以","极大","的","提高","编辑","效率","，","这边","比较","推荐","typora","自","带","的","评论","框架","非常","坑","，","如果","想闭坑","请","移步","高","更新","率","的","主题","，","否则","就","啃食","主题","源代码","或者","自己","编写","主题","吧","~"],"url":"https://bawanag.github.io/2020/01/20/Hexo-%E7%BE%A4%E8%BE%89%E6%90%AD%E5%BB%BA%E9%87%87%E5%9D%91%E8%AE%B0/","title":"群辉docker搭建Hexo踩坑记","content":"Hexo 以及 Hexo admin 搭建踩坑部分教程引用https://drunkfish.me/hexo/\n群辉可以直接使用spurin/hexo docker镜像\n虽然这个镜像集成了Hexo以及Hexo admin，但是Hexo...","author":"bawanag","categorie":{"url":"https://bawanag.github.io/categories/Experience/","name":"Experience"},"date":"2020-01-20 07:36:00"}]